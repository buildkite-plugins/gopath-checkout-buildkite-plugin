#!/bin/bash

set -eu

# Remove extra _BUILDKITE_PLUGIN in env variable names (BUILDKITE_PLUGIN_GOLANG_BUILDKITE_PLUGIN_IMPORT -> BUILDKITE_PLUGIN_GOLANG_IMPORT)
export $(env | grep "BUILDKITE_PLUGIN_GOLANG_BUILDKITE_PLUGIN_" | sed "s/BUILDKITE_PLUGIN_GOLANG_BUILDKITE_PLUGIN_/BUILDKITE_PLUGIN_GOLANG_/g")

if [[ ! -z "${BUILDKTE_PLUGIN_GOLANG_IMPORT:-}" ]]; then
	echo "--- :golang: Setting up Golang build environment"
	export GOPATH="$BUILDKITE_BUILD_CHECKOUT_PATH"
	export BUILDKITE_BUILD_CHECKOUT_PATH="$BUILDKITE_BUILD_CHECKOUT_PATH/src/$BUILDKTE_PLUGIN_GOLANG_IMPORT"
else
	echo "+++ :golang: No 'import' option specified"
	env | grep 'BUILDKITE_'
	exit 1
fi
